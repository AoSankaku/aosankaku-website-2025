---
import WorkCard from "./atoms/WorkCard.astro";
import moremobilityImage from "@/assets/homepage/works/moremobility_340.png";
import serverImage1 from "@/assets/homepage/works/server_1_340.jpg";
import partyparrotStreamdeckImage from "@/assets/homepage/works/partyparrot_streamdeck.png";
import craftskyImage from "@/assets/homepage/works/craftsky.png";
import typingImage from "@/assets/homepage/works/typing_340.jpg";
import keybaseImage from "@/assets/homepage/works/keybase_340.png";
import profileIcon250 from "@/assets/profileicon250.png";
import stationSignGeneratorImage from "@/assets/homepage/works/station_sign_generator.png";
---

<h2>みてみてコーナー</h2>

<section class="embla" id="works-embla">
  <div class="embla__viewport">
    <div class="embla__container">
      <div class="embla__slide">
        <WorkCard
          title="Moremobility Mod"
          imageSrc={moremobilityImage}
          link="https://modrinth.com/mod/moremobility"
          linkText="Modrinthで見る"
        >
          俺が作ったものではなく、sysnoteくゃんが作ってくれました。Automobilityを拡張するアドオンです。でっかい収穫機やネザライトエンジンなどを追加します。
        </WorkCard>
      </div>

      <div class="embla__slide">
        <WorkCard title="Create Citiesサーバー" imageSrc={serverImage1}>
          マイクラサバもやってます。恐ろしい量のMODが工業を中心に入っています。友人限定ですが、知り合いの方で興味があれば広く参加を受け付けています。
        </WorkCard>
      </div>

      <div class="embla__slide">
        <WorkCard
          title="StreamDeck用CPUモニター"
          imageSrc={partyparrotStreamdeckImage}
          link="https://github.com/AoSankaku/cpu-partyparrot/releases"
          linkText="ダウンロード（GitHub）"
        >
          StreamDeckで、PartyParrotがCPU使用率を教えてくれるプラグインを作りました。ほぼバイブコーディングで作った初作品でもあります。
        </WorkCard>
      </div>

      <div class="embla__slide">
        <WorkCard
          title="【作成中】駅名標ジェネレーター"
          imageSrc={stationSignGeneratorImage}
        >
          駅名標を簡単に作成できるWebアプリケーションを作成中です。基本機能はできているのですが破壊的な変更を含む拡張が必要なので、完成したらここでお知らせします。
        </WorkCard>
      </div>

      <div class="embla__slide">
        <WorkCard title="タイピングガチ勢" imageSrc={typingImage}>
          神になりました。いい資格とかがなくて証明方法に困っています。なんかいいもの知ってたらぜひ教えて下さい。
        </WorkCard>
      </div>

      <div class="embla__slide">
        <WorkCard
          title="【公開準備中】くらふとすきー"
          imageSrc={craftskyImage}
          link="https://crafters.aosankaku.net"
          linkText="見に行く"
        >
          「なんか作ってる人」が気軽に集まることができるようなMisskeyサーバーを準備中です。
        </WorkCard>
      </div>

      <div class="embla__slide">
        <WorkCard
          title="Keybaseによる本人証明"
          imageSrc={keybaseImage}
          link="https://keybase.io/ao_sankaku"
          linkText="見に行く"
        >
          Keybase経由で、このサイトとaosankaku.comが私のものであることを証明しています。
        </WorkCard>
      </div>

      <div class="embla__slide">
        <WorkCard title="アイコンについて" imageSrc={profileIcon250}>
          親友に描いてもらったものです。なんだかんだ8年以上愛用しています。ちなみにあおさんかくは普通に絵が下手です。
        </WorkCard>
      </div>
    </div>
  </div>
</section>

<style>
  .embla {
    --slide-spacing: 0px;
    --slide-size: 320px;
    --slide-height: 660px;

    margin: 60px 0;
    overflow: hidden;
    contain: layout paint;
    height: var(--slide-height);
  }

  @media (min-width: 768px) {
    .embla {
      --slide-spacing: 25px;
      --slide-size: 480px;
      --slide-height: 780px;
    }
  }

  .embla__viewport {
    overflow: hidden;
    height: 100%;
  }

  .embla__container {
    display: flex;
    height: 100%;
    backface-visibility: hidden;
    touch-action: pan-y;
    margin-left: calc(var(--slide-spacing) * -1);
  }

  .embla__slide {
    flex: 0 0 var(--slide-size);
    min-width: 0;
    padding-left: var(--slide-spacing);
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
</style>

<script>
  import EmblaCarousel from "embla-carousel";
  import Autoplay from "embla-carousel-autoplay";
  // If you add other plugins (like navigation dots), import them here

  const initEmbla = () => {
    const rootNode = document.querySelector("#works-embla") as HTMLElement;
    const viewportNode = rootNode?.querySelector(
      ".embla__viewport",
    ) as HTMLElement;

    if (!viewportNode) return;

    const emblaApi = EmblaCarousel(
      viewportNode,
      {
        loop: true,
        align: "center",
        skipSnaps: false,
        duration: 30,
      },
      [
        // Add plugins here
        Autoplay({
          delay: 8000,
          stopOnInteraction: false,
        }),
      ],
    );

    // Optional: Add event listeners for custom navigation (e.g., dots, arrows)
    // emblaApi.on('select', () => { /* Update active dot */ });
  };

  // Lazy load Embla using IntersectionObserver
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          initEmbla();
          observer.disconnect();
        }
      });
    },
    { rootMargin: "400px" },
  );

  const target = document.querySelector("#works-embla");
  if (target) observer.observe(target);
</script>
