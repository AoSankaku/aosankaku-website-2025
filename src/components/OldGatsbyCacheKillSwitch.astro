<script is:inline>
  /**
   * This script removes Gatsby's service worker and clears local caches.
   * It prevents returning visitors from seeing a cached version of the old site.
   */

  async function surgicalGatsbyClean() {
    // 1. Unregister Service Workers (Gatsby usually only has one)
    if ("serviceWorker" in navigator) {
      const registrations = await navigator.serviceWorker.getRegistrations();
      for (let registration of registrations) {
        // Gatsby's default worker is usually named sw.js
        if (!sessionStorage.getItem("gatsby-cleaned")) {
          await registration.unregister();
          sessionStorage.setItem("gatsby-cleaned", "true");
          window.location.reload();
        }
      }
    }

    // 2. Only delete caches that look like Gatsby caches
    if ("caches" in window) {
      const keys = await caches.keys();
      for (let key of keys) {
        if (key.includes("gatsby")) {
          await caches.delete(key);
          console.log(`Deleted Gatsby cache: ${key}`);
        }
      }
    }
  }
  surgicalGatsbyClean();
</script>
